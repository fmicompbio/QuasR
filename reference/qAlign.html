<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Align reads — qAlign • QuasR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Align reads — qAlign" />
<meta property="og:description" content="Create read alignments against reference genome and optional auxiliary
targets if not yet existing. If necessary, also build target indices for
the aligner." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">QuasR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.31.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/QuasR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Align reads</h1>
    
    <div class="hidden name"><code>qAlign.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create read alignments against reference genome and optional auxiliary
targets if not yet existing. If necessary, also build target indices for
the aligner.</p>
    </div>

    <pre class="usage"><span class='fu'>qAlign</span><span class='op'>(</span><span class='va'>sampleFile</span>, 
       <span class='va'>genome</span>, 
       auxiliaryFile<span class='op'>=</span><span class='cn'>NULL</span>, 
       aligner<span class='op'>=</span><span class='st'>"Rbowtie"</span>, 
       maxHits<span class='op'>=</span><span class='fl'>1</span>, 
       paired<span class='op'>=</span><span class='cn'>NULL</span>, 
       splicedAlignment<span class='op'>=</span><span class='cn'>FALSE</span>, 
       snpFile<span class='op'>=</span><span class='cn'>NULL</span>, 
       bisulfite<span class='op'>=</span><span class='st'>"no"</span>, 
       alignmentParameter<span class='op'>=</span><span class='cn'>NULL</span>, 
       projectName<span class='op'>=</span><span class='st'>"qProject"</span>, 
       alignmentsDir<span class='op'>=</span><span class='cn'>NULL</span>, 
       lib.loc<span class='op'>=</span><span class='cn'>NULL</span>, 
       cacheDir<span class='op'>=</span><span class='cn'>NULL</span>, 
       clObj<span class='op'>=</span><span class='cn'>NULL</span>,
       checkOnly<span class='op'>=</span><span class='cn'>FALSE</span>,
       geneAnnotation<span class='op'>=</span><span class='cn'>NULL</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sampleFile</th>
      <td><p>the name of a text file listing input sequence files
    and sample names (see &#8216;Details&#8217;).</p></td>
    </tr>
    <tr>
      <th>genome</th>
      <td><p>the reference genome for primary alignments, one of:</p><ul>
<li><p>a string referring to a &#8220;BSgenome&#8221; package
      (e.g. &#8220;"BSgenome.Hsapiens.UCSC.hg19"&#8221;), which will be
      downloaded automatically from Bioconductor if not present</p></li>
<li><p>the name of a fasta sequence file containing one or
      several sequences (chromosomes) to be used as a reference. The aligner
      index will be created when neccessary and stored in a default
      location (see &#8216;Details&#8217;).</p></li>
</ul><p></p></td>
    </tr>
    <tr>
      <th>auxiliaryFile</th>
      <td><p>the name of a text file listing sequences to be
    used as additional targets for alignment of reads not mapping to the
    reference genome (see &#8216;Details&#8217;).</p></td>
    </tr>
    <tr>
      <th>aligner</th>
      <td><p>selects the aligner program to be used for aligning the
    reads. Currently, only &#8220;Rbowtie&#8221; and &#8220;Rhisat2&#8221; are supported,
    which are R wrapper packages for &#8216;bowtie&#8217; / &#8216;SpliceMap&#8217; and
    &#8216;hisat2&#8217;, respectively (see <code><a href='https://rdrr.io/pkg/Rbowtie/man/Rbowtie-package.html'>Rbowtie-package</a></code> and
    <code><a href='https://rdrr.io/pkg/Rhisat2/man/Rhisat2-package.html'>Rhisat2-package</a></code> packages).</p></td>
    </tr>
    <tr>
      <th>maxHits</th>
      <td><p>sets the maximal number of allowed mapping positions
    per read (default: 1). If a read produces more than <code>maxHits</code>
    alignments, no alignments will be reported for it. In case of a
    multi-mapping read, a single alignment is randomly selected</p></td>
    </tr>
    <tr>
      <th>paired</th>
      <td><p>defines the type of paired-end library and can be set to
    one of <code>no</code> (single read experiment, default), <code>fr</code> (fw/rev),
    <code>ff</code> (fw/fw) or <code>rf</code> (rev/fw).</p></td>
    </tr>
    <tr>
      <th>splicedAlignment</th>
      <td><p>if <code>TRUE</code>, reads will be aligned using a
    spliced aligner, depending on the value of <code>aligner</code> described above:</p><ul>
<li><p><code>aligner="Rhisat2"</code>: This is the recommended setting
          for spliced alignments and will use hisat2 from the
          <code><a href='https://rdrr.io/pkg/Rhisat2/man/Rhisat2-package.html'>Rhisat2-package</a></code>. See also the <code>geneAnnotation</code>
          argument below for providing known exon-exon junctions.</p></li>
<li><p><code>aligner="Rbowtie"</code>: This is not recommended and only
          available for legacy reasons. It will use SpliceMap to produce spliced
          alignments (without using a database of known exon-exon junctions).
          Compared to the alternative alignment modes (non-spliced or spliced using
          <code>Rhisat2</code> as aligner), this alignment mode is about ten-fold slower
          and also less sensitive. Furthermore, SpliceMap can only be used for
          reads with a minimal length of 50nt; SpliceMap ignores reads that are
          shorter, and these reads will not be contained in the BAM file,
          neither as mapped or unmapped reads.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>snpFile</th>
      <td><p>the name of a text file listing single nucleotide
    polymorphisms to be used for allele-specific alignment and
    quantification (see &#8216;Details&#8217;).</p></td>
    </tr>
    <tr>
      <th>bisulfite</th>
      <td><p>for bisulfite-converted samples (Bis-seq), the type
    of bisulfite library (&#8220;dir&#8221; for directional libraries,
    &#8220;undir&#8221; for undirectional libraries).</p></td>
    </tr>
    <tr>
      <th>alignmentParameter</th>
      <td><p>a optional string containing command line
    parameters to be used for the aligner, to overrule the default
    alignment parameters used by <code>QuasR</code>. Please use with caution;
    some alignment parameters may break assumptions made by
    <code>QuasR</code>. Default parameters are listed in &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>projectName</th>
      <td><p>an optional name for the alignment project.</p></td>
    </tr>
    <tr>
      <th>alignmentsDir</th>
      <td><p>the directory to be used for storing alignments
    (bam files). If set to <code>NULL</code> (default), bam files will be
    generated at the location of the input sequence files.</p></td>
    </tr>
    <tr>
      <th>lib.loc</th>
      <td><p>can be used to change the default library path of
    R. The library path is used by <code>QuasR</code> to store aligner index
    packages created from <code>BSgenome</code> reference genomes, or to
    install newly downloaded <code>BSgenome</code> packages.</p></td>
    </tr>
    <tr>
      <th>cacheDir</th>
      <td><p>specifies the location to store (potentially huge)
    temporary files. If set to <code>NULL</code> (default), the temporary
    directory of the current R session as returned by <code><a href='https://rdrr.io/r/base/tempfile.html'>tempdir()</a></code>
    will be used.</p></td>
    </tr>
    <tr>
      <th>clObj</th>
      <td><p>a cluster object, created by the package
    <span class="pkg">parallel</span>, to enable parallel processing and
    speed up the alignment process.</p></td>
    </tr>
    <tr>
      <th>checkOnly</th>
      <td><p>if <code>TRUE</code>, prevents the automatic creation of
    alignments or aligner indices. This allows to quickly check for missing
    alignment files without starting the potentially long process of
    their creation. In the case of missing alignments or indices, an
    exception is thrown.</p></td>
    </tr>
    <tr>
      <th>geneAnnotation</th>
      <td><p>Only used if <code>aligner</code> is <code>"Rhisat2"</code>. 
    The path to either a gtf file or a sqlite database generated by exporting 
    a <code>TxDb</code> object. This file is used to generate a splice site file 
    for <code>Rhisat2</code>, that will be used to guide the spliced alignment.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Before generating new alignments, <code>qAlign</code> looks for previously
  generated alignments as well as for an aligner index. If no aligner
  index exists, it will be automatically created and stored in the same
  directory as the provided fasta file, or as an R package in the case
  of a BSgenome reference. The name of this R package will be the same
  as the BSgenome package name, with an additional suffix from the
  aligner (e.g. <code>BSgenome.Hsapiens.UCSC.hg19.Rbowtie</code>). The
  generated bam files contain both aligned und unaligned reads. For
  paired-end samples, by default no alignments will be reported for
  read pairs where only one of the reads could be aligned.</p>  
<p><code>sampleFile</code> is a tab-delimited text file listing all the input
  sequences to be included in a given analysis. The file has either two
  (single-end) or three columns (paired-end). The first row contains the
  column names, and additional rows contain relative or absolute path
  and name of input sequence file(s), as well as the according sample
  name. Three input file formats are supported (fastq, fasta and
  bam). All input files in one <code>sampleFile</code> need to be in the same
  format, and are recognized by their extension (.fq, .fastq, .fa,
  .fasta, .fna, .bam), in raw or compressed form (e.g. .fastq.gz). If
  bam files are provided, then no alignments are generated by
  <code>qAlign</code>, and the alignments contained in the bam files will be
  used instead.</p>
<p>The column names in <code>sampleFile</code> have to match to the ones in the
  examples below, for a single-read experiment:</p><table class='table'>
<tr><td>FileName</td><td>SampleName</td></tr>
<tr><td>chip_1_1.fq.bz2</td><td>Sample1</td></tr>
<tr><td>chip_2_1.fq.bz2</td><td>Sample2</td></tr>
</table>
<p>and for a paired-end experiment:</p><table class='table'>
<tr><td>FileName1</td><td>FileName2</td><td>SampleName</td></tr>
<tr><td>rna_1_1.fq.bz2</td><td>rna_1_2.fq.bz2</td><td>Sample1</td></tr>
<tr><td>rna_2_1.fq.bz2</td><td>rna_2_2.fq.bz2</td><td>Sample2</td></tr>
</table>


<p>The &#8220;SampleName&#8221; column is the human-readable name for each
  sample that will be used as sample labels. Multiple sequence files may
  be associated to the same sample name, which instructs <code>QuasR</code> to
  combine those files.</p>
<p><code>auxiliaryFile</code> is a tab-delimited text file listing one or
  several additional target sequence files in fasta format. Reads that
  do not map against the reference genome will be aligned against each
  of these target sequence files. The first row contains the column
  names which have to match to the ones in the example below:</p><table class='table'>
<tr><td>FileName</td><td>AuxName</td></tr>
<tr><td>NC_001422.1.fa</td><td>phiX174</td></tr>
</table>


<p><code>snpFile</code> is a tab-delimited text file without a header and
  contains four columns with chromosome name, position, reference allele
  and alternative allele, as in the example below:</p><table class='table'>
<tr><td>chr1</td><td>8596</td><td>G</td><td>A</td></tr>
<tr><td>chr1</td><td>18443</td><td>G</td><td>A</td></tr>
<tr><td>chr1</td><td>18981</td><td>C</td><td>T</td></tr>
<tr><td>chr1</td><td>19341</td><td>G</td><td>A</td></tr>
</table>


<p>The reference and alternative alleles will be injected into the
  reference genome, resulting in two separate genomes. All reads will be
  aligned separately to both of these genomes, and the alignments will
  be combined, only retaining the best alignment for each read. In the
  final alignment, each read will be marked with a tag that classifies
  it into reference (<code>R</code>), alternative (<code>A</code>) or unknown
  (<code>U</code>), if the reads maps equally well to both genomes.</p>
<p>If <code>bisulfite</code> is set to &#8220;dir&#8221; or &#8220;undir&#8221;, reads
  will be C-to-T converted and aligned to a similarly converted genome.</p>
<p>If <code>alignmentParameter</code> is <code>NULL</code> (recommended),
  <code>qAlign</code> will select default parameters that are suitable for the
  experiment type. Please note that for bisulfite or allele-specific
  experiments, each read is aligned multiple times, and resulting
  alignments need to be combined. This requires special settings for the
  alignment parameters that are not recommended to be changed. For
  &#8216;simple&#8217; experiments (neither bisulfite, allele-specific, nor
  spliced), alignments are generated using the parameters <code>-m
  maxHits --best --strata</code>. This will align reads with up to
  &#8220;maxHits&#8221; best hits in the genome and selects one of them randomly.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code><a href='qProject-class.html'>qProject</a></code> object.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Anita Lerch, Dimos Gaidatzis, Charlotte Soneson and Michael Stadler</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='qProject-class.html'>qProject</a></code>,
  <code><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></code> from package <span class="pkg">parallel</span>,
  <code><a href='https://rdrr.io/pkg/Rbowtie/man/Rbowtie-package.html'>Rbowtie-package</a></code> package,
  <code><a href='https://rdrr.io/pkg/Rhisat2/man/Rhisat2-package.html'>Rhisat2-package</a></code> package</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='co'># see qCount, qMeth and qProfile manual pages for examples</span>
    <span class='fu'><a href='https://rdrr.io/r/utils/example.html'>example</a></span><span class='op'>(</span><span class='va'>qCount</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/r/utils/example.html'>example</a></span><span class='op'>(</span><span class='va'>qMeth</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/r/utils/example.html'>example</a></span><span class='op'>(</span><span class='va'>qProfile</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michael Stadler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


